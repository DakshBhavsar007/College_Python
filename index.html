<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz Portal - FSD & Python MCQs</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        :root {
            --primary: #0891b2;
            --secondary: #dc2626;
            --bg: #f8fafc;
            --glass: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(148, 163, 184, 0.2);
            --correct: #16a34a;
            --wrong: #dc2626;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border-color: #e2e8f0;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-primary);
            overflow-x: hidden;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
        }

        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.2;
            pointer-events: none;
        }

        .glass {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .nav-link:hover {
            color: var(--primary);
        }

        .section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.4s forwards;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hover-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        @media (hover: hover) {
            .hover-card:hover {
                transform: translateY(-5px);
                border-color: var(--primary);
                box-shadow: 0 20px 25px -5px rgba(8, 145, 178, 0.15), 0 10px 10px -5px rgba(8, 145, 178, 0.1);
            }
        }

        /* Quiz Option Buttons */
        .option-btn {
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }

        .option-btn:active {
            background: rgba(15, 23, 42, 0.1);
        }

        .option-btn.correct {
            background: rgba(22, 163, 74, 0.1) !important;
            border-color: var(--correct) !important;
            color: var(--correct) !important;
            font-weight: 600;
        }

        .option-btn.wrong {
            background: rgba(220, 38, 38, 0.1) !important;
            border-color: var(--wrong) !important;
            color: var(--wrong) !important;
            font-weight: 600;
        }

        /* Study Mode Styles */
        .study-answer-correct {
            background: rgba(22, 163, 74, 0.1);
            border: 2px solid var(--correct);
            color: var(--correct);
            font-weight: 600;
        }

        .study-answer-normal {
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.6);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>

<body>

    <canvas id="bg-canvas"></canvas>

    <nav class="fixed top-0 w-full z-50 glass border-b border-gray-200 bg-white/90 backdrop-blur-xl shadow-sm">
        <div class="container mx-auto px-6 py-4">
            <div class="flex flex-wrap justify-between items-center">

                <button onclick="showSection('home')" class="flex items-center gap-3 group z-50 focus:outline-none">
                    <div
                        class="w-10 h-10 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-lg">
                        QZ
                    </div>
                    <span class="text-xl font-bold tracking-tight text-gray-900">Quiz Portal</span>
                </button>

                <button id="menu-btn" class="md:hidden text-2xl text-gray-900 p-2 focus:outline-none z-50"
                    onclick="toggleMenu()">
                    <i class="fa-solid fa-bars" id="menu-icon"></i>
                </button>

                <div id="nav-content"
                    class="hidden w-full md:block md:w-auto mt-4 md:mt-0 transition-all duration-300 max-h-[80vh] overflow-y-auto md:max-h-none md:overflow-visible">
                    <div
                        class="flex flex-col md:flex-row md:items-center gap-2 md:gap-8 bg-white md:bg-transparent p-4 md:p-0 rounded-2xl md:rounded-none border border-gray-200 md:border-0 shadow-lg md:shadow-none">
                        <button onclick="showSection('home')"
                            class="nav-link text-left text-gray-700 font-semibold py-3 px-2 rounded hover:bg-gray-100 md:hover:bg-transparent">Home</button>

                        <div class="h-px w-full md:h-6 md:w-px bg-gray-300 mx-0 md:mx-2 my-2 md:my-0"></div>

                        <button onclick="selectSubject('python')"
                            class="text-left text-yellow-600 font-semibold flex items-center gap-3 py-3 px-2 rounded hover:bg-yellow-50 md:hover:bg-transparent">
                            <i class="fa-brands fa-python text-xl"></i> Python
                        </button>
                        <button onclick="selectSubject('de')"
                            class="text-left text-purple-600 font-semibold flex items-center gap-3 py-3 px-2 rounded hover:bg-purple-50 md:hover:bg-transparent">
                            <i class="fa-solid fa-microchip text-xl"></i> DE
                        </button>

                        <button onclick="selectSubject('etc')"
                            class="text-left text-green-600 font-semibold flex items-center gap-3 py-3 px-2 rounded hover:bg-green-50 md:hover:bg-transparent">
                            <i class="fa-solid fa-comments text-xl"></i> ETC
                        </button>
                        <button onclick="selectSubject('ci')"
                            class="text-left text-orange-600 font-semibold flex items-center gap-3 py-3 px-2 rounded hover:bg-orange-50 md:hover:bg-transparent">
                            <i class="fa-solid fa-scale-balanced text-xl"></i> CI
                        </button>
                        <!-- FSD temporarily hidden
                        <button onclick="selectSubject('fsd')"
                            class="text-left text-blue-600 font-semibold flex items-center gap-3 py-3 px-2 rounded hover:bg-blue-50 md:hover:bg-transparent">
                            <i class="fa-solid fa-code text-xl"></i> FSD
                        </button>
                        -->
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="pt-28 pb-24 container mx-auto px-6 min-h-screen relative z-10">

        <section id="home" class="section active">
            <div class="text-center max-w-3xl mx-auto mb-10">
                <span class="text-primary text-xs font-bold tracking-[0.2em] uppercase mb-4 block">Free Learning</span>
                <h1 class="text-4xl md:text-6xl font-extrabold mb-6 leading-tight text-gray-900">
                    <span class="text-blue-600">Full Stack Development</span>
                </h1>
                <p class="text-gray-600 mb-6">Select FSD modules below to view topics.</p>
                <button onclick="showLeaderboard()"
                    class="inline-flex items-center gap-2 px-6 py-2 bg-white text-yellow-600 font-bold rounded-full shadow-md hover:shadow-lg border border-yellow-100 transition-all hover:-translate-y-0.5">
                    <i class="fa-solid fa-trophy"></i> View Leaderboard
                </button>
            </div>

            <div class="flex flex-col md:flex-row justify-center items-center gap-8 md:gap-12 max-w-5xl mx-auto">
                <button onclick="selectSubject('python')"
                    class="w-full md:w-80 text-center glass hover-card rounded-3xl p-12 md:p-14 group relative overflow-hidden focus:outline-none transform transition-all duration-300 hover:scale-105 border border-yellow-500/20">
                    <div
                        class="absolute top-0 right-0 w-48 h-48 bg-yellow-500/15 rounded-full blur-3xl -mr-20 -mt-20 group-hover:bg-yellow-500/25 transition-all duration-300">
                    </div>
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-yellow-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 rounded-3xl">
                    </div>
                    <div class="relative z-10 flex flex-col items-center text-center">
                        <div
                            class="w-28 h-28 bg-gradient-to-br from-yellow-400/30 to-yellow-600/20 rounded-2xl flex items-center justify-center mb-6 shadow-xl border-2 border-yellow-500/40 group-hover:border-yellow-500/70 transition-all duration-300">
                            <i
                                class="fa-brands fa-python text-6xl text-yellow-600 group-hover:scale-110 transition-transform duration-300"></i>
                        </div>
                        <h2
                            class="text-4xl font-black text-gray-900 mb-3 group-hover:text-yellow-700 transition-colors duration-300">
                            Python</h2>
                        <p class="text-gray-700 text-base mb-6 font-semibold">View & Test (T1 - T4)</p>
                        <span
                            class="text-yellow-700 font-bold text-base bg-gradient-to-r from-yellow-400/30 to-yellow-400/15 px-6 py-3 rounded-full border-2 border-yellow-500/40 group-hover:border-yellow-500/70 group-hover:bg-yellow-400/30 transition-all duration-300">Enter
                            &rarr;</span>
                    </div>
                </button>

                <button onclick="selectSubject('de')"
                    class="w-full md:w-80 text-center glass hover-card rounded-3xl p-12 md:p-14 group relative overflow-hidden focus:outline-none transform transition-all duration-300 hover:scale-105 border border-purple-500/20">
                    <div
                        class="absolute top-0 right-0 w-48 h-48 bg-purple-500/15 rounded-full blur-3xl -mr-20 -mt-20 group-hover:bg-purple-500/25 transition-all duration-300">
                    </div>
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 rounded-3xl">
                    </div>
                    <div class="relative z-10 flex flex-col items-center text-center">
                        <div
                            class="w-28 h-28 bg-gradient-to-br from-purple-400/30 to-purple-600/20 rounded-2xl flex items-center justify-center mb-6 shadow-xl border-2 border-purple-500/40 group-hover:border-purple-500/70 transition-all duration-300">
                            <i
                                class="fa-solid fa-microchip text-6xl text-purple-600 group-hover:scale-110 transition-transform duration-300"></i>
                        </div>
                        <h2
                            class="text-4xl font-black text-gray-900 mb-3 group-hover:text-purple-700 transition-colors duration-300">
                            DE</h2>
                        <p class="text-gray-700 text-base mb-6 font-semibold">View & Test (T1 - T4)</p>
                        <span
                            class="text-purple-700 font-bold text-base bg-gradient-to-r from-purple-400/30 to-purple-400/15 px-6 py-3 rounded-full border-2 border-purple-500/40 group-hover:border-purple-500/70 group-hover:bg-purple-400/30 transition-all duration-300">Enter
                            &rarr;</span>
                    </div>
                </button>




                <button onclick="selectSubject('etc')"
                    class="w-full md:w-80 text-center glass hover-card rounded-3xl p-12 md:p-14 group relative overflow-hidden focus:outline-none transform transition-all duration-300 hover:scale-105 border border-green-500/20">
                    <div
                        class="absolute top-0 right-0 w-48 h-48 bg-green-500/15 rounded-full blur-3xl -mr-20 -mt-20 group-hover:bg-green-500/25 transition-all duration-300">
                    </div>
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-green-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 rounded-3xl">
                    </div>
                    <div class="relative z-10 flex flex-col items-center text-center">
                        <div
                            class="w-28 h-28 bg-gradient-to-br from-green-400/30 to-green-600/20 rounded-2xl flex items-center justify-center mb-6 shadow-xl border-2 border-green-500/40 group-hover:border-green-500/70 transition-all duration-300">
                            <i
                                class="fa-solid fa-comments text-6xl text-green-600 group-hover:scale-110 transition-transform duration-300"></i>
                        </div>
                        <h2
                            class="text-4xl font-black text-gray-900 mb-3 group-hover:text-green-700 transition-colors duration-300">
                            ETC</h2>
                        <p class="text-gray-700 text-base mb-6 font-semibold">View & Test (All Units)</p>
                        <span
                            class="text-green-700 font-bold text-base bg-gradient-to-r from-green-400/30 to-green-400/15 px-6 py-3 rounded-full border-2 border-green-500/40 group-hover:border-green-500/70 group-hover:bg-green-400/30 transition-all duration-300">Enter
                            &rarr;</span>
                    </div>
                </button>

                <button onclick="selectSubject('ci')"
                    class="w-full md:w-80 text-center glass hover-card rounded-3xl p-12 md:p-14 group relative overflow-hidden focus:outline-none transform transition-all duration-300 hover:scale-105 border border-orange-500/20">
                    <div
                        class="absolute top-0 right-0 w-48 h-48 bg-orange-500/15 rounded-full blur-3xl -mr-20 -mt-20 group-hover:bg-orange-500/25 transition-all duration-300">
                    </div>
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-orange-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 rounded-3xl">
                    </div>
                    <div class="relative z-10 flex flex-col items-center text-center">
                        <div
                            class="w-28 h-28 bg-gradient-to-br from-orange-400/30 to-orange-600/20 rounded-2xl flex items-center justify-center mb-6 shadow-xl border-2 border-orange-500/40 group-hover:border-orange-500/70 transition-all duration-300">
                            <i
                                class="fa-solid fa-scale-balanced text-6xl text-orange-600 group-hover:scale-110 transition-transform duration-300"></i>
                        </div>
                        <h2
                            class="text-4xl font-black text-gray-900 mb-3 group-hover:text-orange-700 transition-colors duration-300">
                            CI</h2>
                        <p class="text-gray-700 text-base mb-6 font-semibold">View & Test (All Units)</p>
                        <span
                            class="text-orange-700 font-bold text-base bg-gradient-to-r from-orange-400/30 to-orange-400/15 px-6 py-3 rounded-full border-2 border-orange-500/40 group-hover:border-orange-500/70 group-hover:bg-orange-400/30 transition-all duration-300">Enter
                            &rarr;</span>
                    </div>
                </button>


                <!-- FSD card temporarily hidden
                <button onclick="selectSubject('fsd')"
                    class="w-full md:w-80 text-center glass hover-card rounded-3xl p-12 md:p-14 group relative overflow-hidden focus:outline-none transform transition-all duration-300 hover:scale-105 border border-blue-500/20">
                    <div
                        class="absolute top-0 right-0 w-48 h-48 bg-blue-500/15 rounded-full blur-3xl -mr-20 -mt-20 group-hover:bg-blue-500/25 transition-all duration-300">
                    </div>
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 rounded-3xl">
                    </div>
                    <div class="relative z-10 flex flex-col items-center text-center">
                        <div
                            class="w-28 h-28 bg-gradient-to-br from-blue-400/30 to-blue-600/20 rounded-2xl flex items-center justify-center mb-6 shadow-xl border-2 border-blue-500/40 group-hover:border-blue-500/70 transition-all duration-300">
                            <i
                                class="fa-solid fa-layer-group text-6xl text-blue-600 group-hover:scale-110 transition-transform duration-300"></i>
                        </div>
                        <h2
                            class="text-4xl font-black text-gray-900 mb-3 group-hover:text-blue-700 transition-colors duration-300">
                            FSD</h2>
                        <p class="text-gray-700 text-base mb-6 font-semibold">View & Test (T1 - T4)</p>
                        <span
                            class="text-blue-700 font-bold text-base bg-gradient-to-r from-blue-400/30 to-blue-400/15 px-6 py-3 rounded-full border-2 border-blue-500/40 group-hover:border-blue-500/70 group-hover:bg-blue-400/30 transition-all duration-300">Enter
                            &rarr;</span>
                    </div>
                </button>
                -->
            </div>
        </section>

        <section id="topics" class="section">
            <div class="max-w-4xl mx-auto">
                <button onclick="showSection('home')"
                    class="text-gray-600 hover:text-primary flex items-center gap-2 mb-8 transition-colors font-semibold">
                    <i class="fa-solid fa-arrow-left"></i> Back to Home
                </button>

                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold mb-2 text-gray-900">Select Topic</h2>
                    <p id="topic-subtitle" class="text-gray-600">Practice or View Answers</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div id="card-T1"
                        class="glass p-6 rounded-2xl border border-gray-200 hover:border-primary/50 transition-all shadow-sm">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <span class="text-xs font-bold text-gray-500 block mb-1 tracking-widest">MODULE</span>
                                <span class="text-4xl font-extrabold text-gray-900">T1</span>
                            </div>
                            <div class="p-3 bg-primary/10 rounded-lg text-primary">
                                <i class="fa-solid fa-bookmark"></i>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="viewAnswers('T1')"
                                class="py-3 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-semibold transition-colors flex justify-center items-center gap-2">
                                <i class="fa-solid fa-eye"></i> View
                            </button>
                            <button onclick="initQuiz('T1')"
                                class="py-3 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-bold shadow-md hover:shadow-lg transition-all flex justify-center items-center gap-2">
                                <i class="fa-solid fa-play"></i> Test
                            </button>
                        </div>
                    </div>

                    <div id="card-T2"
                        class="glass p-6 rounded-2xl border border-gray-200 hover:border-primary/50 transition-all shadow-sm">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <span class="text-xs font-bold text-gray-500 block mb-1 tracking-widest">MODULE</span>
                                <span class="text-4xl font-extrabold text-gray-900">T2</span>
                            </div>
                            <div class="p-3 bg-primary/10 rounded-lg text-primary">
                                <i class="fa-solid fa-bookmark"></i>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="viewAnswers('T2')"
                                class="py-3 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-semibold transition-colors flex justify-center items-center gap-2">
                                <i class="fa-solid fa-eye"></i> View
                            </button>
                            <button onclick="initQuiz('T2')"
                                class="py-3 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-bold shadow-md hover:shadow-lg transition-all flex justify-center items-center gap-2">
                                <i class="fa-solid fa-play"></i> Test
                            </button>
                        </div>
                    </div>

                    <div id="card-T3"
                        class="glass p-6 rounded-2xl border border-gray-200 hover:border-primary/50 transition-all shadow-sm">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <span class="text-xs font-bold text-gray-500 block mb-1 tracking-widest">MODULE</span>
                                <span class="text-4xl font-extrabold text-gray-900">T3</span>
                            </div>
                            <div class="p-3 bg-primary/10 rounded-lg text-primary">
                                <i class="fa-solid fa-bookmark"></i>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="viewAnswers('T3')"
                                class="py-3 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-semibold transition-colors flex justify-center items-center gap-2">
                                <i class="fa-solid fa-eye"></i> View
                            </button>
                            <button onclick="initQuiz('T3')"
                                class="py-3 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-bold shadow-md hover:shadow-lg transition-all flex justify-center items-center gap-2">
                                <i class="fa-solid fa-play"></i> Test
                            </button>
                        </div>
                    </div>

                    <div id="card-T4"
                        class="glass p-6 rounded-2xl border border-gray-200 hover:border-primary/50 transition-all shadow-sm">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <span class="text-xs font-bold text-gray-500 block mb-1 tracking-widest">MODULE</span>
                                <span class="text-4xl font-extrabold text-gray-900">T4</span>
                            </div>
                            <div class="p-3 bg-primary/10 rounded-lg text-primary">
                                <i class="fa-solid fa-bookmark"></i>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="viewAnswers('T4')"
                                class="py-3 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-semibold transition-colors flex justify-center items-center gap-2">
                                <i class="fa-solid fa-eye"></i> View
                            </button>
                            <button onclick="initQuiz('T4')"
                                class="py-3 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-bold shadow-md hover:shadow-lg transition-all flex justify-center items-center gap-2">
                                <i class="fa-solid fa-play"></i> Test
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="study" class="section">
            <div class="max-w-3xl mx-auto">
                <div
                    class="flex items-center justify-between mb-8 sticky top-24 bg-white/95 backdrop-blur-xl p-4 -mx-4 z-40 border-b border-gray-200 shadow-sm rounded-b-xl">
                    <button onclick="showSection('topics')"
                        class="text-gray-600 hover:text-primary flex items-center gap-2 font-semibold">
                        <i class="fa-solid fa-arrow-left"></i> Back
                    </button>
                    <h2 id="study-title" class="text-xl font-bold text-gray-900"></h2>
                </div>

                <div id="study-content" class="space-y-8 pb-10">
                </div>
            </div>
        </section>

        <section id="quiz" class="section">
            <div class="max-w-3xl mx-auto">
                <div class="flex items-center justify-between mb-6">
                    <button onclick="endQuiz()"
                        class="text-gray-600 hover:text-primary flex items-center gap-2 py-2 font-semibold transition-colors">
                        <i class="fa-solid fa-arrow-left"></i> Quit
                    </button>
                    <div class="flex items-center gap-4">
                        <div class="text-sm font-bold text-primary bg-primary/10 px-3 py-1 rounded-lg">
                            <i class="fa-regular fa-clock mr-2"></i><span id="q-timer">20:00</span>
                        </div>
                        <div class="text-sm font-mono text-gray-600">
                            Sr. No. <span id="q-current" class="text-gray-900 font-bold">1</span> / <span
                                id="q-total">10</span>
                        </div>
                    </div>
                </div>

                <div class="glass rounded-3xl p-6 md:p-10 border border-gray-200">
                    <h2 id="q-text" class="text-xl md:text-2xl font-bold mb-8 leading-snug text-gray-900"></h2>
                    <div id="q-options" class="grid gap-3"></div>

                    <div class="mt-8 flex justify-between items-center border-t border-gray-200 pt-6">
                        <button id="btn-prev" onclick="prevQ()"
                            class="px-4 py-2 rounded-lg text-gray-700 hover:text-gray-900 bg-gray-100 hover:bg-gray-200 disabled:opacity-50 font-semibold transition-colors">Prev</button>

                        <button id="btn-skip" onclick="skipQ()"
                            class="px-4 py-2 rounded-lg text-yellow-600 hover:text-yellow-700 bg-yellow-50 hover:bg-yellow-100 font-semibold transition-colors">
                            Skip
                        </button>

                        <button id="btn-next" onclick="nextQ()"
                            class="px-6 py-2 bg-gradient-to-r from-green-400 to-emerald-600 text-white font-bold rounded-lg shadow-lg hover:shadow-green-500/25 active:scale-95 transition-all">Next</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Result Section -->
        <section id="result" class="section">
            <div class="max-w-md mx-auto">
                <div class="glass p-8 rounded-3xl border border-gray-200 text-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-primary/10 rounded-full blur-3xl -mr-20 -mt-20">
                    </div>
                    <div class="absolute bottom-0 left-0 w-64 h-64 bg-secondary/10 rounded-full blur-3xl -ml-20 -mb-20">
                    </div>

                    <div class="relative z-10">
                        <div
                            class="w-24 h-24 mx-auto bg-gradient-to-br from-cyan-400 to-blue-600 rounded-full flex items-center justify-center shadow-lg mb-6 text-white text-4xl font-bold">
                            <i class="fa-solid fa-trophy"></i>
                        </div>

                        <h2 class="text-3xl font-extrabold text-gray-900 mb-2">Quiz Completed!</h2>
                        <p class="text-gray-600 mb-8" id="result-stat-msg">Great job!</p>

                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-white/50 p-4 rounded-2xl border border-gray-100">
                                <span
                                    class="block text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Score</span>
                                <span class="text-3xl font-black text-gray-900" id="result-score">0/0</span>
                            </div>
                            <div class="bg-white/50 p-4 rounded-2xl border border-gray-100">
                                <span
                                    class="block text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Accuracy</span>
                                <span class="text-3xl font-black text-primary" id="result-accuracy">0%</span>
                            </div>
                            <div class="bg-white/50 p-4 rounded-2xl border border-gray-100">
                                <span class="block text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Time
                                    Taken</span>
                                <span class="text-xl font-black text-gray-900" id="result-time">0m 0s</span>
                            </div>
                            <div class="bg-white/50 p-4 rounded-2xl border border-gray-100">
                                <span
                                    class="block text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Speed</span>
                                <span class="text-xl font-black text-blue-600" id="result-speed">0 Q/min</span>
                            </div>
                        </div>

                        <div class="bg-yellow-50 p-4 rounded-2xl border border-yellow-100 mb-8 mx-auto w-full max-w-xs">
                            <span class="block text-yellow-600 text-xs font-bold uppercase tracking-wider mb-1">Best
                                Accuracy</span>
                            <div class="flex items-center justify-center gap-2">
                                <i class="fa-solid fa-crown text-yellow-500"></i>
                                <span class="text-2xl font-black text-yellow-700" id="result-best">0%</span>
                            </div>
                        </div>

                        <div class="flex flex-col gap-3">
                            <button onclick="showSection('topics')"
                                class="w-full py-4 bg-gray-900 text-white font-bold rounded-xl shadow-lg hover:bg-gray-800 transition-all">
                                Back to Topics
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Leaderboard Section -->
        <section id="leaderboard" class="section">
            <div class="max-w-2xl mx-auto">
                <div class="flex items-center justify-between mb-8">
                    <button onclick="showSection('home')"
                        class="text-gray-600 hover:text-primary flex items-center gap-2 font-semibold">
                        <i class="fa-solid fa-arrow-left"></i> Home
                    </button>
                    <h2 class="text-2xl font-bold text-gray-900">Your Rankings</h2>
                </div>

                <div class="glass rounded-3xl p-6 md:p-8 border border-gray-200 min-h-[50vh]">
                    <div class="flex justify-between items-center mb-8">
                        <h3 class="text-xl font-bold text-gray-800 flex items-center">
                            <i class="fa-solid fa-trophy text-yellow-500 mr-3 text-2xl"></i> Top Performances
                        </h3>
                        <button onclick="clearLeaderboard()"
                            class="text-xs text-red-500 hover:text-red-700 bg-red-50 hover:bg-red-100 px-3 py-1 rounded-lg font-semibold transition-colors">
                            Clear History
                        </button>
                    </div>

                    <div id="leaderboard-list" class="space-y-4">
                        <!-- Content injected by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Chapter Selection Modal (Modified for Dynamic Content) -->
        <div id="chapter-modal" class="fixed inset-0 z-[100] hidden">
            <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeChapterModal()"></div>
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
                <div class="glass rounded-2xl p-6 md:p-8 animate-fadeInUp">
                    <div class="text-center mb-8">
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">Select Chapter</h3>
                        <p class="text-gray-600">Choose which chapter you want to cover</p>
                    </div>

                    <div id="chapter-list" class="grid gap-4">
                        <!-- Content injected by JS -->
                    </div>

                    <button onclick="closeChapterModal()"
                        class="mt-6 w-full py-3 text-gray-500 font-semibold hover:text-gray-700 transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>

        <div class="fixed bottom-2 right-4 text-xs text-gray-400 z-50 pointer-events-none">v1.2</div>
    </main>

    <script>
        // --- DATA ---
        // ... (QUESTION_BANK is large, we keep it as is. JS functions below need update) ...

        // --- DATA ---
        let QUESTION_BANK = {};

        async function loadQuestionBank() {
            try {
                // Load all JSON files in parallel with cache busting
                const v = Date.now(); // Cache buster
                const [pythonRes, deRes, etcRes, ciRes] = await Promise.all([
                    fetch(`questions/python.json?v=${v}`),
                    fetch(`questions/de.json?v=${v}`),
                    fetch(`questions/etc.json?v=${v}`),
                    fetch(`questions/ci.json?v=${v}`)
                ]);

                const pythonData = await pythonRes.json();
                const deData = await deRes.json();
                const etcData = await etcRes.json();
                const ciData = await ciRes.json();

                QUESTION_BANK = {
                    python: pythonData,
                    de: deData,
                    etc: { T4: etcData.T4 },
                    ci: { T4: ciData.T4 }
                };
                // etc and ci structure in files might be {"T4": [...]} or just object with T4 key
                // Let's assume the files contain the proper structure or we adjust here.
                // Based on previous extractions: 
                // etc.json has { "T4": [...] }
                // ci.json has { "T4": [...] }
                // python.json has { "T1": ..., "T2", ... }
                // de.json has { "T1": ..., "T2", ... }

                // So simple assignment is likely correct, but let's be safe:
                QUESTION_BANK['python'] = pythonData;
                QUESTION_BANK['de'] = deData;

                // For ETC and CI, we extracted them earlier.
                // If the json file contains { "T4": [...] }, then:
                QUESTION_BANK['etc'] = etcData;
                QUESTION_BANK['ci'] = ciData;

                console.log("Question Bank Loaded Successfully");

            } catch (error) {
                console.error("Failed to load question bank:", error);
                alert("Error loading quiz data. Please check your connection or local server.");
            }
        }

        // Load data immediately
        loadQuestionBank();


        let currentSubject = '';
        let currentQuizData = [];
        let currentQIdx = 0;
        let answers = {};
        let answeredState = {};
        let timerInterval;
        let remainingSeconds = 1200; // 20 minutes
        const TOTAL_QUIZ_TIME = 1200;

        // --- NAVIGATION ---

        function showSection(id) {
            document.querySelectorAll('.section').forEach(el => {
                el.classList.remove('active');
                el.style.display = 'none';
            });

            // Allow returning directly to home from anywhere
            if (id === 'home') {
                currentSubject = '';
            }

            const target = document.getElementById(id);
            target.style.display = 'block';
            setTimeout(() => target.classList.add('active'), 10);

            // Auto close menu
            document.getElementById('nav-content').classList.add('hidden');
            document.getElementById('menu-icon').classList.replace('fa-xmark', 'fa-bars');
        }

        function toggleMenu() {
            const nav = document.getElementById('nav-content');
            const icon = document.getElementById('menu-icon');
            if (nav.classList.contains('hidden')) {
                nav.classList.remove('hidden');
                icon.classList.replace('fa-bars', 'fa-xmark');
            } else {
                nav.classList.add('hidden');
                icon.classList.replace('fa-xmark', 'fa-bars');
            }
        }

        // --- VIEW ANSWERS MODE ---
        let selectionMode = ''; // 'view' or 'quiz'
        let pendingTopic = '';

        function viewAnswers(topic) {
            // Check if T4 for Python or DE or etc or ci -> Open Chapter Modal
            if (topic === 'T4' && (currentSubject === 'python' || currentSubject === 'de' || currentSubject === 'etc' || currentSubject === 'ci')) {
                selectionMode = 'view';
                pendingTopic = topic;
                openChapterModal();
                return;
            }
            startViewAnswers(topic);
        }

        function startViewAnswers(topic, filterUnit = null) {
            let topicData = QUESTION_BANK[currentSubject][topic];

            if (filterUnit) {
                topicData = topicData.filter(q => q.unit === filterUnit);
            }

            if (!topicData || topicData.length === 0) {
                alert("No questions found for this selection.");
                return;
            }

            const container = document.getElementById('study-content');
            let title = `${currentSubject.toUpperCase()} - ${topic}`;
            if (filterUnit) title += ` (Chapter ${filterUnit})`;
            document.getElementById('study-title').innerText = title + " Answer Key";

            let html = '';
            topicData.forEach((item, index) => {
                html += `
                    <div class="glass p-6 rounded-2xl border border-gray-200 shadow-sm">
                        <div class="flex gap-4 mb-4">
                            <span class="text-primary font-bold text-lg">Sr. No. ${index + 1}.</span>
                            <h3 class="text-lg font-semibold text-gray-900 leading-relaxed">${item.q}</h3>
                        </div>
                        <div class="space-y-2 ml-0 md:ml-10">
                `;

                item.options.forEach((opt, optIdx) => {
                    const isCorrect = (optIdx === item.ans);
                    const styleClass = isCorrect ? 'study-answer-correct' : 'study-answer-normal';
                    const icon = isCorrect ? '<i class="fa-solid fa-check ml-auto"></i>' : '';

                    html += `
                        <div class="p-3 rounded-lg text-sm flex items-center ${styleClass}">
                            <span>${opt}</span>
                            ${icon}
                        </div>
                    `;
                });

                html += `</div></div>`;
            });

            container.innerHTML = html;
            showSection('study');
        }

        // --- NAVIGATION ---
        function selectSubject(subject) {
            currentSubject = subject;
            const colors = {
                'python': 'yellow',
                'de': 'purple',
                'etc': 'green',
                'ci': 'orange',
                'fsd': 'blue'
            };
            const color = colors[subject] || 'blue';

            document.getElementById('topic-subtitle').innerHTML =
                `Select a <span class="text-${color}-600 font-bold uppercase">${subject}</span> module`;

            // Toggle visibility of modules based on subject
            const modules = ['T1', 'T2', 'T3', 'T4'];
            modules.forEach(mod => {
                const card = document.getElementById(`card-${mod}`);
                if (card) {
                    if ((subject === 'ci' || subject === 'etc') && mod !== 'T4') {
                        card.style.display = 'none';
                    } else {
                        card.style.display = 'block';
                    }
                }
            });

            showSection('topics');
        }

        // --- CHAPTER MODAL (DYNAMIC) ---
        function openChapterModal() {
            const list = document.getElementById('chapter-list');
            list.innerHTML = ''; // Clear previous

            let chapters = [];
            if (currentSubject === 'python') {
                chapters = ['9', '10'];
            } else if (currentSubject === 'de') {
                chapters = ['8', '9', '10'];
            } else if (currentSubject === 'etc' || currentSubject === 'ci') {
                const data = QUESTION_BANK[currentSubject]['T4'] || [];
                const uniqueUnits = [...new Set(data.map(q => q.unit))];
                chapters = uniqueUnits.sort((a, b) => parseInt(a) - parseInt(b));
            }

            // Container
            const container = document.createElement('div');
            container.className = "flex flex-col gap-5";

            // Styled Wrapper for Select
            const selectWrapper = document.createElement('div');
            selectWrapper.className = "relative";

            // Select Element
            const select = document.createElement('select');
            select.id = "chapter-dropdown";
            select.className = "w-full appearance-none bg-gray-50 border border-gray-300 text-gray-900 text-lg rounded-xl py-4 px-5 pr-10 focus:outline-none focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all font-semibold cursor-pointer shadow-sm hover:border-gray-400";

            // Arrow Icon
            const arrow = document.createElement('div');
            arrow.className = "absolute right-5 top-1/2 transform -translate-y-1/2 text-gray-500 pointer-events-none";
            arrow.innerHTML = '<i class="fa-solid fa-chevron-down text-sm"></i>';

            // Default Option
            const defaultOpt = document.createElement('option');
            defaultOpt.value = "";
            defaultOpt.innerText = "Select a Chapter";
            defaultOpt.disabled = true;
            defaultOpt.selected = true;
            select.appendChild(defaultOpt);

            // Populate Options
            chapters.forEach(ch => {
                const opt = document.createElement('option');
                opt.value = ch;
                opt.innerText = `Chapter ${ch}`;
                select.appendChild(opt);
            });

            selectWrapper.appendChild(select);
            selectWrapper.appendChild(arrow);
            container.appendChild(selectWrapper);

            // Enter Button
            const btn = document.createElement('button');
            btn.innerHTML = 'Start Practice <i class="fa-solid fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>';
            btn.className = "group w-full py-4 bg-primary text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-primary/30 hover:bg-cyan-700 active:scale-[0.98] transition-all flex justify-center items-center";
            btn.onclick = () => {
                const val = select.value;
                if (!val) {
                    select.classList.add('ring-2', 'ring-red-500', 'border-red-500');
                    setTimeout(() => select.classList.remove('ring-2', 'ring-red-500', 'border-red-500'), 500);
                    return;
                }
                selectChapter(val);
            };
            container.appendChild(btn);

            list.appendChild(container);
            document.getElementById('chapter-modal').classList.remove('hidden');
        }

        function initQuiz(topic) {
            if (topic === 'T4' && (currentSubject === 'python' || currentSubject === 'de' || currentSubject === 'etc' || currentSubject === 'ci')) {
                selectionMode = 'quiz';
                pendingTopic = topic;
                openChapterModal();
                return;
            }
            startQuiz(topic);
        }

        function closeChapterModal() {
            document.getElementById('chapter-modal').classList.add('hidden');
            selectionMode = '';
            pendingTopic = '';
        }

        function selectChapter(chapter) {
            const mode = selectionMode;
            const topic = pendingTopic;
            closeChapterModal();
            if (mode === 'view') {
                startViewAnswers(topic, chapter);
            } else if (mode === 'quiz') {
                startQuiz(topic, chapter);
            }
        }

        function startQuiz(topic, filterUnit = null) {
            let topicData = QUESTION_BANK[currentSubject][topic];
            if (filterUnit) {
                topicData = topicData.filter(q => q.unit === filterUnit);
            }

            if (!topicData || topicData.length === 0) {
                alert("No questions found for this selection.");
                return;
            }

            // 1. Select Questions (Shuffle & Limit)
            let selectedData = [];
            if (currentSubject === 'etc' || currentSubject === 'ci') {
                selectedData = [...topicData].sort(() => 0.5 - Math.random());
            } else {
                selectedData = [...topicData].sort(() => 0.5 - Math.random()).slice(0, 10);
            }

            // 2. Shuffle Options for each question
            currentQuizData = selectedData.map(q => {
                // Deep copy to avoid modifying original QUESTION_BANK
                const newQ = JSON.parse(JSON.stringify(q));

                // Create an array of indices [0, 1, 2, 3...]
                const indices = newQ.options.map((_, i) => i);

                // Shuffle the indices
                indices.sort(() => Math.random() - 0.5);

                // Reorder options based on shuffled indices
                newQ.options = indices.map(i => q.options[i]);

                // Update the correct answer index to track where the original answer went
                newQ.ans = indices.indexOf(q.ans);

                return newQ;
            });
            currentQIdx = 0;
            answers = {};
            answeredState = {};

            document.getElementById('q-total').innerText = currentQuizData.length;
            showSection('quiz');
            startTimer();
            renderQuestion();
        }

        function startTimer() {
            clearInterval(timerInterval);
            remainingSeconds = TOTAL_QUIZ_TIME;
            const timerDisplay = document.getElementById('q-timer');
            timerDisplay.innerText = "20:00";
            timerDisplay.classList.remove('text-red-600');

            timerInterval = setInterval(() => {
                remainingSeconds--;
                if (remainingSeconds < 0) {
                    endQuiz(true); // Auto submit
                    return;
                }

                // Alert visual when low
                if (remainingSeconds <= 60) {
                    timerDisplay.classList.add('text-red-600');
                }

                const mins = Math.floor(remainingSeconds / 60);
                const secs = remainingSeconds % 60;
                timerDisplay.innerText =
                    (mins < 10 ? "0" + mins : mins) + ":" +
                    (secs < 10 ? "0" + secs : secs);
            }, 1000);
        }

        function endQuiz(showResults = false) {
            clearInterval(timerInterval);
            if (!showResults) {
                if (confirm("Are you sure you want to quit?")) showSection('topics');
                else {
                    // Resume timer logic
                    timerInterval = setInterval(() => {
                        remainingSeconds--;
                        if (remainingSeconds < 0) { endQuiz(true); return; }
                        const mins = Math.floor(remainingSeconds / 60);
                        const secs = remainingSeconds % 60;
                        document.getElementById('q-timer').innerText = (mins < 10 ? "0" + mins : mins) + ":" + (secs < 10 ? "0" + secs : secs);
                    }, 1000);
                }
            } else {
                calculateResults();
            }
        }

        function calculateResults() {
            let score = 0;
            currentQuizData.forEach((q, i) => { if (answers[i] === q.ans) score++; });
            const total = currentQuizData.length;
            const accuracy = Math.round((score / total) * 100);

            // Time Calculations
            const timeTaken = TOTAL_QUIZ_TIME - remainingSeconds;
            // Speed = Correct Answers / Time Taken (we'll do per minute for readability, or pure ratio)
            // User requested: speed = correct answers / timeTaken. 
            // If we strictly follow that, it's small (e.g. 5/30 = 0.16). 
            // Normalized to Q/min is usually better: (score / timeTaken) * 60
            const speedVal = timeTaken > 0 ? (score / timeTaken) : 0; // ans per second

            // Format time taken
            const takenMins = Math.floor(timeTaken / 60);
            const takenSecs = timeTaken % 60;
            const timeString = `${takenMins}m ${takenSecs}s`;

            // Performance Level
            let performance = "";
            let msg = "";

            if (accuracy >= 90) { performance = "Excellent"; msg = "Outstanding performance!"; }
            else if (accuracy >= 75) { performance = "Good"; msg = "Great job!"; }
            else if (accuracy >= 50) { performance = "Average"; msg = "Good effort, keep improving!"; }
            else { performance = "Needs Practice"; msg = "Keep studying, you can do it!"; }

            // Best Accuracy
            const storageKey = `quiz_best_${currentSubject}_${pendingTopic || 'mixed'}`;
            let bestAcc = localStorage.getItem(storageKey) || 0;
            if (accuracy > bestAcc) {
                bestAcc = accuracy;
                localStorage.setItem(storageKey, bestAcc);
            }

            document.getElementById('result-score').innerText = `${score}/${total}`;
            document.getElementById('result-accuracy').innerText = `${accuracy}%`;
            document.getElementById('result-time').innerText = timeString;
            // showing speed as Ans/min for friendly UI
            // document.getElementById('result-speed').innerText = `${(speedVal * 60).toFixed(1)} Q/min`;
            // Actually, let's just show the raw ratio nicely or per minute
            document.getElementById('result-speed').innerText = `${speedVal.toFixed(2)} ans/s`;

            document.getElementById('result-best').innerText = `${bestAcc}%`;
            document.getElementById('result-stat-msg').innerHTML = `<span class="block text-xl font-bold text-primary mb-1">${performance}</span>${msg}`;

            // Save to Leaderboard
            saveToLeaderboard({
                subject: currentSubject,
                topic: pendingTopic || 'Mixed',
                score: score,
                total: total,
                accuracy: accuracy,
                time: timeString,
                date: new Date().toLocaleDateString()
            });

            showSection('result');
        }

        // --- LEADERBOARD ---
        function saveToLeaderboard(entry) {
            let lb = JSON.parse(localStorage.getItem('ws_leaderboard') || '[]');
            lb.push(entry);
            // Sort by accuracy desc, then score desc
            lb.sort((a, b) => b.accuracy - a.accuracy || b.score - a.score);
            // Keep top 50
            if (lb.length > 50) lb = lb.slice(0, 50);
            localStorage.setItem('ws_leaderboard', JSON.stringify(lb));
        }

        function showLeaderboard() {
            const lb = JSON.parse(localStorage.getItem('ws_leaderboard') || '[]');
            const list = document.getElementById('leaderboard-list');

            if (lb.length === 0) {
                list.innerHTML = `<div class="text-center py-12">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400">
                        <i class="fa-solid fa-clipboard-list text-2xl"></i>
                    </div>
                    <p class="text-gray-500 font-medium">No results yet.</p>
                    <p class="text-gray-400 text-sm mt-1">Complete a quiz to see your ranking!</p>
                </div>`;
            } else {
                let html = '';
                lb.forEach((item, idx) => {
                    let medal = '';
                    if (idx === 0) medal = '<i class="fa-solid fa-medal text-yellow-400 text-xl"></i>';
                    else if (idx === 1) medal = '<i class="fa-solid fa-medal text-gray-400 text-xl"></i>';
                    else if (idx === 2) medal = '<i class="fa-solid fa-medal text-amber-600 text-xl"></i>';
                    else medal = `<span class="text-gray-400 font-bold w-6 text-center">#${idx + 1}</span>`;

                    const subjectColors = {
                        'python': 'text-yellow-600 bg-yellow-50 border-yellow-100',
                        'de': 'text-purple-600 bg-purple-50 border-purple-100',
                        'etc': 'text-green-600 bg-green-50 border-green-100',
                        'ci': 'text-orange-600 bg-orange-50 border-orange-100'
                    };
                    const badgeClass = subjectColors[item.subject] || 'text-blue-600 bg-blue-50 border-blue-100';

                    html += `
                        <div class="flex items-center p-4 rounded-2xl bg-white border border-gray-100 shadow-sm hover:shadow-md transition-all gap-4">
                            <div class="flex-shrink-0 w-10 flex justify-center">
                                ${medal}
                            </div>
                            <div class="flex-grow">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-xs font-bold uppercase px-2 py-0.5 rounded border ${badgeClass}">${item.subject.toUpperCase()}</span>
                                    <span class="text-sm font-semibold text-gray-600">${item.topic}</span>
                                </div>
                                <div class="text-xs text-gray-400 flex gap-3">
                                    <span><i class="fa-regular fa-calendar mr-1"></i>${item.date}</span>
                                    <span><i class="fa-regular fa-clock mr-1"></i>${item.time}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="block text-xl font-black text-gray-900">${item.accuracy}%</span>
                                <span class="text-xs font-semibold text-gray-500">${item.score}/${item.total}</span>
                            </div>
                        </div>
                    `;
                });
                list.innerHTML = html;
            }
            showSection('leaderboard');
        }

        function clearLeaderboard() {
            if (confirm("Are you sure you want to clear your history?")) {
                localStorage.removeItem('ws_leaderboard');
                showLeaderboard();
            }
        }


        function renderQuestion() {
            const qData = currentQuizData[currentQIdx];
            document.getElementById('q-current').innerText = currentQIdx + 1;
            const qText = document.getElementById('q-text');
            const container = document.getElementById('q-options');

            qText.innerHTML = qData.q;
            container.innerHTML = '';

            const hasAnswered = answeredState[currentQIdx];

            qData.options.forEach((opt, idx) => {
                const btn = document.createElement('div');
                let classes = `option-btn p-4 rounded-xl border-2 border-gray-200 bg-white/80 text-base text-gray-900`;

                if (hasAnswered) {
                    classes += " cursor-default";
                    if (idx === qData.ans) classes += " correct";
                    else if (answers[currentQIdx] === idx) classes += " wrong";
                    else classes += " opacity-50";
                }

                btn.className = classes;
                btn.innerHTML = opt;

                if (!hasAnswered) {
                    btn.onclick = () => {
                        answers[currentQIdx] = idx;
                        answeredState[currentQIdx] = true;
                        renderQuestion();
                    };
                }
                container.appendChild(btn);
            });

            document.getElementById('btn-prev').disabled = (currentQIdx === 0);
            document.getElementById('btn-skip').style.display = (hasAnswered || currentQIdx === currentQuizData.length - 1) ? 'none' : 'block';
            document.getElementById('btn-next').innerText = (currentQIdx === currentQuizData.length - 1) ? "Finish" : "Next";
        }

        function skipQ() {
            if (currentQIdx < currentQuizData.length - 1) {
                currentQIdx++;
                renderQuestion();
            }
        }

        function nextQ() {
            if (currentQIdx < currentQuizData.length - 1) {
                currentQIdx++;
                renderQuestion();
            } else {
                endQuiz(true);
            }
        }

        function prevQ() {
            if (currentQIdx > 0) {
                currentQIdx--;
                renderQuestion();
            }
        }

        // Init background
        setTimeout(() => {
            const canvas = document.getElementById('bg-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.position.z = 5;

            const count = window.innerWidth < 768 ? 200 : 500;
            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(count * 3);
            for (let i = 0; i < count * 3; i++) pos[i] = (Math.random() - 0.5) * 15;
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const mat = new THREE.PointsMaterial({ size: 0.02, color: 0x0891b2, transparent: true, opacity: 0.6 });
            const mesh = new THREE.Points(geo, mat);
            scene.add(mesh);

            function animate() {
                requestAnimationFrame(animate);
                mesh.rotation.y += 0.001;
                renderer.render(scene, camera);
            }
            animate();
        }, 100);
    </script>
</body>

</html>